<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Inventaire des manquants</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
  <style>
    :root {
      color-scheme: light;
      font-family: "Inter", system-ui, -apple-system, sans-serif;
      --bg: #f6f6fb;
      --card-radius: 18px;
      --shadow: 0 12px 30px rgba(17, 24, 39, 0.12);
      --text-dark: #14171f;
      --text-light: #ffffff;
      --accent: #3b82f6;
      --accent-dark: #1e40af;
      --muted: #6b7280;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      background: var(--bg);
      color: var(--text-dark);
    }

    .app {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    header {
      padding: 24px 20px 16px;
    }

    .inventory-header {
      padding: 0;
    }

    header h1 {
      margin: 0;
      font-size: 1.5rem;
      font-weight: 700;
    }

    header p {
      margin: 6px 0 0;
      color: var(--muted);
      font-size: 0.95rem;
    }

    .top-actions {
      margin-top: 16px;
      display: flex;
      justify-content: flex-start;
    }

    .top-reset-button {
      border: none;
      border-radius: 999px;
      padding: 10px 18px;
      font-weight: 600;
      background: #dc2626;
      color: #ffffff;
      box-shadow: 0 12px 20px rgba(220, 38, 38, 0.35);
    }

    .top-reset-button:active {
      transform: translateY(1px);
    }

    .section {
      padding: 0 20px 24px;
    }

    .section h2 {
      font-size: 1.2rem;
      margin: 20px 0 12px;
      font-weight: 600;
    }

    .list {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .item-card {
      display: grid;
      grid-template-columns: 52px 1fr auto;
      align-items: center;
      gap: 12px;
      padding: 14px 16px;
      border-radius: var(--card-radius);
      box-shadow: var(--shadow);
      color: var(--text-light);
      position: relative;
      overflow: hidden;
    }

    .item-card.light-text {
      color: var(--text-dark);
    }

    .item-card::after {
      content: "";
      position: absolute;
      inset: 0;
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.06), rgba(0, 0, 0, 0.12));
      pointer-events: none;
    }

    .item-card.light-text::after {
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.35), rgba(255, 255, 255, 0.15));
    }

    .item-card > * {
      position: relative;
      z-index: 1;
    }

    .item-card img {
      width: 52px;
      height: 52px;
      border-radius: 14px;
      object-fit: cover;
      background: #ffffff;
      border: 2px solid rgba(255, 255, 255, 0.25);
    }

    .item-details h3 {
      margin: 0;
      font-size: 1rem;
      font-weight: 600;
    }

    .item-details span {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      margin-top: 4px;
      font-size: 0.85rem;
      opacity: 0.9;
    }

    .counter {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      background: rgba(0, 0, 0, 0.25);
      border-radius: 999px;
      padding: 6px 8px;
    }

    .item-card.light-text .counter {
      background: rgba(255, 255, 255, 0.6);
    }

    .counter button {
      border: none;
      background: rgba(255, 255, 255, 0.2);
      color: inherit;
      width: 28px;
      height: 28px;
      border-radius: 50%;
      font-size: 1rem;
      font-weight: 600;
    }

    .item-card.light-text .counter button {
      background: rgba(0, 0, 0, 0.08);
    }

    .counter button:active {
      transform: scale(0.95);
    }

    .counter-value {
      font-size: 1rem;
      font-weight: 600;
      min-width: 22px;
      text-align: center;
      cursor: pointer;
    }

    .counter-input {
      width: 60px;
      border: none;
      border-radius: 999px;
      padding: 6px 10px;
      font-size: 0.95rem;
      font-weight: 600;
      text-align: center;
    }

    .counter-input:focus {
      outline: 2px solid rgba(255, 255, 255, 0.7);
    }

    .edit-button {
      position: sticky;
      bottom: 16px;
      margin: 0 20px 24px;
      padding: 14px 20px;
      border-radius: 999px;
      border: none;
      background: var(--accent);
      color: white;
      font-size: 1rem;
      font-weight: 600;
      box-shadow: 0 16px 30px rgba(59, 130, 246, 0.35);
    }

    .edit-button:active {
      transform: translateY(1px);
    }

    .list-view {
      display: none;
      flex-direction: column;
      gap: 12px;
      padding: 0 20px 24px;
    }

    .list-view.active {
      display: flex;
    }

    .reassort-banner {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 12px;
      padding: 16px 20px 8px;
      text-align: center;
    }

    .reassort-banner img {
      width: min(260px, 90%);
      border-radius: 16px;
      box-shadow: 0 12px 20px rgba(15, 23, 42, 0.18);
    }

    .reassort-banner p {
      margin: 0;
      font-size: 1.4rem;
      font-weight: 700;
      color: #111827;
      text-transform: uppercase;
      letter-spacing: 0.03em;
    }

    .missing-card {
      display: grid;
      grid-template-columns: 72px 1fr auto;
      gap: 14px;
      align-items: center;
      padding: 14px 16px;
      border-radius: 16px;
      background: white;
      box-shadow: 0 12px 20px rgba(15, 23, 42, 0.08);
      border: 1px solid #e5e7eb;
      min-height: 86px;
    }

    .missing-card.done {
      opacity: 0.35;
    }

    .missing-card img {
      width: 72px;
      height: 72px;
      border-radius: 16px;
      object-fit: cover;
      background: #ffffff;
      border: 1px solid #e5e7eb;
    }

    .missing-details {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .missing-details h3 {
      margin: 0;
      font-size: 1rem;
      color: var(--text-dark);
    }

    .missing-details span {
      color: var(--muted);
      font-size: 0.9rem;
    }

    .missing-amount {
      font-size: 1.35rem;
      font-weight: 700;
      color: var(--text-dark);
    }

    .check-button {
      border: none;
      background: #22c55e;
      color: white;
      border-radius: 50%;
      width: 36px;
      height: 36px;
      font-size: 1.1rem;
      display: grid;
      place-items: center;
      box-shadow: 0 8px 16px rgba(34, 197, 94, 0.35);
    }

    .secondary-actions {
      display: flex;
      gap: 10px;
      margin: 8px 20px 20px;
    }

    .secondary-actions button {
      flex: 1;
      border-radius: 999px;
      padding: 12px;
      border: none;
      font-weight: 600;
    }

    .back-button {
      background: #111827;
      color: white;
    }

    .reset-button {
      background: #e5e7eb;
      color: #111827;
    }

    .notes-section {
      margin-top: 16px;
      padding: 16px;
      border-radius: 16px;
      background: #f3f4f6;
      border: 1px solid #e5e7eb;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .notes-section h3 {
      margin: 0;
      font-size: 1rem;
      font-weight: 600;
      color: var(--text-dark);
    }

    .notes-section textarea {
      min-height: 120px;
      border-radius: 12px;
      border: 1px solid #d1d5db;
      padding: 10px 12px;
      font-family: inherit;
      font-size: 0.95rem;
      resize: vertical;
      background: #ffffff;
      color: var(--text-dark);
    }

    @media (min-width: 720px) {
      .app {
        max-width: 680px;
        margin: 0 auto;
      }
    }
  </style>
</head>
<body>
  <div class="app">
    <main id="inventory-view">
      <section class="section">
        <header class="inventory-header">
          <div class="top-actions">
            <button class="top-reset-button" id="top-reset-button">Réinitialiser la liste</button>
          </div>
        </header>
        <h2>Frigo à emporter</h2>
        <div class="list" id="frigo-list"></div>
      </section>

      <section class="section">
        <h2>Frigo Bar</h2>
        <div class="list" id="bar-list"></div>
        <div class="notes-section">
          <h3>Notes</h3>
          <textarea class="notes-field" placeholder="Ajoutez des notes supplémentaires..."></textarea>
        </div>
      </section>

      <button class="edit-button" id="edit-list">Éditer la liste</button>
    </main>

    <section class="list-view" id="missing-view">
      <header>
        <h1>Liste des manquants</h1>
      </header>
      <div class="reassort-banner" id="reassort-banner" hidden>
        <img src="image/giphy.gif" alt="Gros réassort, gros muscle" />
        <p>Gros réassort, gros muscle, gros champion</p>
      </div>
      <div class="secondary-actions">
        <button class="back-button" id="back-button">Retour</button>
        <button class="reset-button" id="reset-button">Réinitialiser</button>
      </div>
      <div class="list" id="missing-list"></div>
      <div class="notes-section">
        <h3>Notes</h3>
        <textarea class="notes-field" placeholder="Ajoutez des notes supplémentaires..."></textarea>
      </div>
    </section>
  </div>

  <script>
    const STORAGE_KEY = "reassort-frigo-state-v1";

    const items = [
      { id: "heineken-50cl", name: "Heineken 50 cl", category: "Frigo", color: "#1f7a34", image: "heineken-50cl.png" },
      { id: "poliakov", name: "Poliakov", category: "Frigo", color: "#2d2a3a", image: "poliakov.png" },
      { id: "rhum-ambre", name: "Rhum ambré", category: "Frigo", color: "#b45309", image: "rhum-ambre-martiniquais-20cl.png" },
      { id: "rhum-blanc", name: "Rhum blanc", category: "Frigo", color: "#f3f4f6", text: "#111827", image: "rhum-blanc-martiniquais-20cl.png" },
      { id: "label-5", name: "Label 5", category: "Frigo", color: "#0f172a", image: "label-5.png" },
      { id: "desperados-50cl", name: "Desperados 50 cl", category: "Frigo", color: "#f59e0b", text: "#1f2937", image: "desperados-50cl.png" },
      { id: "leffe-50cl", name: "Leffe 50 cl", category: "Frigo", color: "#7c2d12", image: "leffe-50cl.png" },
      { id: "86-50cl", name: "8.6 50 cl", category: "Frigo", color: "#1e3a8a", image: "86-50cl.png" },
      { id: "oasis-tropical-canette", name: "Oasis Tropical (canette)", category: "Frigo", color: "#f97316", text: "#1f2937", image: "oasis-tropical-canette.png" },
      { id: "oasis-rouge-canette", name: "Oasis Rouge (canette)", category: "Frigo", color: "#f43f5e", image: "oasis-pomme-cassis-framboise-canette.png" },
      { id: "orangina-canette", name: "Orangina (canette)", category: "Frigo", color: "#f97316", text: "#1f2937", image: "orangina-canette.png" },
      { id: "ice-tea-canette", name: "Ice Tea (canette)", category: "Frigo", color: "#a16207", image: "lipton-ice-tea-peche-canette.png" },
      { id: "fanta-canette", name: "Fanta (canette)", category: "Frigo", color: "#f59e0b", text: "#1f2937", image: "fanta-orange-canette.png" },
      { id: "sprite-canette", name: "Sprite (canette)", category: "Frigo", color: "#22c55e", text: "#052e16", image: "sprite-canette.png" },
      { id: "coca-cola-canette", name: "Coca-Cola (canette)", category: "Frigo", color: "#b91c1c", image: "coca-cola-canette.png" },
      { id: "ice-tea-bouteille", name: "Ice Tea (bouteille)", category: "Frigo", color: "#b45309", image: "fuze-tea-peche-bouteille.png" },
      { id: "oasis-orange-bouteille", name: "Oasis Orange (bouteille)", category: "Frigo", color: "#fb923c", text: "#1f2937", image: "oasis-tropical-bouteille.png" },
      { id: "oasis-rouge-bouteille", name: "Oasis Rouge (bouteille)", category: "Frigo", color: "#f43f5e", image: "oasis-cassis-framboise-bouteille.png" },
      { id: "coca-cola-bouteille", name: "Coca-Cola (bouteille)", category: "Frigo", color: "#991b1b", image: "coca-cola-bouteille.png" },
      { id: "eau-petite", name: "Eau (petite)", category: "Frigo", color: "#e0f2fe", text: "#0c4a6e", image: "eau-cristaline-50cl.png" },
      { id: "monster", name: "Monster", category: "Frigo", color: "#84cc16", text: "#1f2937", image: "monster-energy.png" },
      { id: "schweppes-canette", name: "Schweppes (canette)", category: "Frigo", color: "#fde68a", text: "#1f2937", image: "schweppes-indian-tonic-canette.png" },
      { id: "coca-zero-canette", name: "Coca-Cola Zéro (canette)", category: "Frigo", color: "#0f172a", image: "coca-zero-canette.png" },
      { id: "coca-grand-format", name: "Coca-Cola (grand format)", category: "Frigo", color: "#dc2626", image: "coca-cola-bouteille.png" },
      { id: "eau-grande", name: "Eau (grande)", category: "Frigo", color: "#bae6fd", text: "#0c4a6e", image: "cristaline-bouteilles-50cl-1.png" },
      { id: "bar-coca-consigne", name: "Bar – Coca-Cola (consigné)", category: "Bar", color: "#7f1d1d", image: "bar-coca-cola-verre-consigne.png" },
      { id: "bar-orangina-consigne", name: "Bar – Orangina (consigné)", category: "Bar", color: "#f97316", text: "#1f2937", image: "bar-orangina-verre.png" },
      { id: "bar-schweppes-consigne", name: "Bar – Schweppes (consigné)", category: "Bar", color: "#fde68a", text: "#1f2937", image: "bar-schweppes-indian-tonic-verre.png" },
      { id: "bar-perrier-consigne", name: "Bar – Perrier (consigné)", category: "Bar", color: "#15803d", image: "bar-perrier-verre.png" },
      { id: "bar-coca-canette", name: "Bar – Coca-Cola (canette)", category: "Bar", color: "#b91c1c", image: "coca-cola-canette.png" },
      { id: "bar-coca-zero-canette", name: "Bar – Coca-Cola Zéro (canette)", category: "Bar", color: "#0f172a", image: "coca-zero-canette.png" },
      { id: "bar-schweppes-canette", name: "Bar – Schweppes (canette)", category: "Bar", color: "#fef08a", text: "#1f2937", image: "schweppes-indian-tonic-canette.png" },
      { id: "bar-jus-ananas", name: "Bar – Jus d’ananas", category: "Bar", color: "#fde047", text: "#1f2937", image: "bar-jus-ananas-granini.png" },
      { id: "bar-jus-abricot", name: "Bar – Jus d’abricot", category: "Bar", color: "#fb923c", text: "#1f2937", image: "bar-jus-ananas-granini.png" },
      { id: "bar-jus-orange", name: "Bar – Jus d’orange", category: "Bar", color: "#f97316", text: "#1f2937", image: "bar-jus-ananas-granini.png" },
      { id: "bar-monster", name: "Bar – Monster", category: "Bar", color: "#84cc16", text: "#1f2937", image: "monster-energy.png" },
      { id: "bar-leffe-0", name: "Bar – Leffe 0%", category: "Bar", color: "#78350f", image: "leffe-blonde-bouteille.png" },
      { id: "bar-chouffe-0", name: "Bar – Chouffe 0%", category: "Bar", color: "#fbbf24", text: "#1f2937", image: "chouffe-0-bouteille.png" },
      { id: "bar-lifemans", name: "Bar – Lifemans", category: "Bar", color: "#e11d48", image: "leffe-blonde-bouteille.png" },
      { id: "bar-chouffe-cherry", name: "Bar – Chouffe Cherry", category: "Bar", color: "#7c3aed", image: "chouffe-cherry-bouteille.png" },
      { id: "bar-leffe", name: "Bar – Leffe", category: "Bar", color: "#7c2d12", image: "leffe-blonde-bouteille.png" },
      { id: "bar-desperados", name: "Bar – Desperados", category: "Bar", color: "#f59e0b", text: "#1f2937", image: "desperados-bouteille.png" },
      { id: "bar-corona", name: "Bar – Corona", category: "Bar", color: "#facc15", text: "#1f2937", image: "corona-bouteille.png" },
    ];

    const defaultState = {
      counts: Object.fromEntries(items.map((item) => [item.id, 0])),
      done: Object.fromEntries(items.map((item) => [item.id, false])),
      notes: ""
    };

    const state = loadState();

    const frigoList = document.getElementById("frigo-list");
    const barList = document.getElementById("bar-list");
    const missingList = document.getElementById("missing-list");
    const reassortBanner = document.getElementById("reassort-banner");
    const notesFields = Array.from(document.querySelectorAll(".notes-field"));
    const inventoryView = document.getElementById("inventory-view");
    const missingView = document.getElementById("missing-view");
    function syncNotesFields() {
      notesFields.forEach((field) => {
        field.value = state.notes || "";
      });
    }

    function slugify(name) {
      return name
        .toLowerCase()
        .normalize("NFD")
        .replace(/\p{Diacritic}/gu, "")
        .replace(/[^a-z0-9]+/g, "-")
        .replace(/(^-|-$)/g, "");
    }

    function loadState() {
      const saved = localStorage.getItem(STORAGE_KEY);
      if (!saved) {
        return structuredClone(defaultState);
      }
      try {
        const parsed = JSON.parse(saved);
        return {
          counts: { ...defaultState.counts, ...(parsed.counts || {}) },
          done: { ...defaultState.done, ...(parsed.done || {}) },
          notes: typeof parsed.notes === "string" ? parsed.notes : ""
        };
      } catch (error) {
        return structuredClone(defaultState);
      }
    }

    function saveState() {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
    }

    function buildCard(item) {
      const card = document.createElement("article");
      card.className = "item-card";
      if (item.text) {
        card.classList.add("light-text");
      }
      card.style.background = item.color;
      if (item.text) {
        card.style.color = item.text;
      }
      const image = document.createElement("img");
      const filename = item.image || `${slugify(item.name)}.png`;
      image.src = `image/${filename}`;
      image.alt = item.name;

      const details = document.createElement("div");
      details.className = "item-details";
      const title = document.createElement("h3");
      title.textContent = item.name;
      details.append(title);

      const counter = document.createElement("div");
      counter.className = "counter";
      counter.dataset.itemId = item.id;

      const minus = document.createElement("button");
      minus.type = "button";
      minus.textContent = "-";
      minus.setAttribute("aria-label", `Diminuer ${item.name}`);

      const value = document.createElement("span");
      value.className = "counter-value";
      value.textContent = state.counts[item.id] ?? 0;
      value.setAttribute("role", "button");
      value.setAttribute("tabindex", "0");
      value.setAttribute("aria-label", `Modifier la quantité de ${item.name}`);

      const input = document.createElement("input");
      input.className = "counter-input";
      input.type = "number";
      input.min = "0";
      input.inputMode = "numeric";
      input.pattern = "[0-9]*";
      input.value = state.counts[item.id] ?? 0;
      input.hidden = true;

      const plus = document.createElement("button");
      plus.type = "button";
      plus.textContent = "+";
      plus.setAttribute("aria-label", `Augmenter ${item.name}`);

      counter.append(minus, value, input, plus);
      card.append(image, details, counter);
      return card;
    }

    function renderLists() {
      frigoList.innerHTML = "";
      barList.innerHTML = "";
      items.forEach((item) => {
        const card = buildCard(item);
        if (item.category === "Frigo") {
          frigoList.appendChild(card);
        } else {
          barList.appendChild(card);
        }
      });
    }

    function renderMissing() {
      missingList.innerHTML = "";
      const missingItems = items.filter((item) => (state.counts[item.id] || 0) > 0);
      if (missingItems.length === 0) {
        const empty = document.createElement("p");
        empty.textContent = "Aucun manquant pour le moment.";
        empty.style.color = "#6b7280";
        empty.style.textAlign = "center";
        missingList.appendChild(empty);
      }
      missingItems.forEach((item) => {
        const card = document.createElement("div");
        card.className = "missing-card";
        if (state.done[item.id]) {
          card.classList.add("done");
        }
        const image = document.createElement("img");
        const filename = item.image || `${slugify(item.name)}.png`;
        image.src = `image/${filename}`;
        image.alt = item.name;

        const details = document.createElement("div");
        details.className = "missing-details";
        const amount = document.createElement("span");
        amount.textContent = `X${state.counts[item.id]}`;
        amount.className = "missing-amount";
        const title = document.createElement("h3");
        title.textContent = item.name;
        details.append(amount, title);

        const button = document.createElement("button");
        button.className = "check-button";
        button.type = "button";
        button.textContent = "✓";
        button.setAttribute("aria-label", `Marquer ${item.name} comme fait`);
        button.addEventListener("click", () => {
          state.done[item.id] = !state.done[item.id];
          saveState();
          renderMissing();
        });

        card.append(image, details, button);
        missingList.appendChild(card);
      });
      updateReassortBanner();
      syncNotesFields();
    }

    function getTotalCount() {
      return items.reduce((total, item) => total + (state.counts[item.id] || 0), 0);
    }

    function updateReassortBanner() {
      if (!reassortBanner) return;
      const shouldShow = missingView.classList.contains("active") && getTotalCount() > 30;
      reassortBanner.hidden = !shouldShow;
    }

    function clampValue(value) {
      const safe = Number.isFinite(value) ? Math.max(0, Math.round(value)) : 0;
      return safe;
    }

    function updateCount(itemId, newValue) {
      state.counts[itemId] = clampValue(newValue);
      state.done[itemId] = false;
      saveState();
      renderLists();
    }

    function handleCounterClick(event) {
      const counter = event.target.closest(".counter");
      if (!counter) return;
      const itemId = counter.dataset.itemId;
      if (!itemId) return;

      const value = counter.querySelector(".counter-value");
      const input = counter.querySelector(".counter-input");
      const current = state.counts[itemId] || 0;

      if (event.target.textContent === "+") {
        updateCount(itemId, current + 1);
        return;
      }
      if (event.target.textContent === "-") {
        updateCount(itemId, current - 1);
        return;
      }

      if (event.target === value) {
        value.hidden = true;
        input.hidden = false;
        input.value = current;
        input.focus();
        input.select();
      }
    }

    function handleInputBlur(event) {
      const input = event.target;
      if (!input.classList.contains("counter-input")) return;
      const counter = input.closest(".counter");
      if (!counter) return;
      const itemId = counter.dataset.itemId;
      const nextValue = clampValue(Number(input.value));
      updateCount(itemId, nextValue);
    }

    function handleInputKey(event) {
      if (event.key === "Enter") {
        event.preventDefault();
        event.target.blur();
      }
    }

    document.addEventListener("click", handleCounterClick);
    document.addEventListener("blur", handleInputBlur, true);
    document.addEventListener("keydown", handleInputKey);

    document.getElementById("edit-list").addEventListener("click", () => {
      renderMissing();
      inventoryView.style.display = "none";
      missingView.classList.add("active");
      updateReassortBanner();
      window.scrollTo({ top: 0, behavior: "smooth" });
    });

    document.getElementById("back-button").addEventListener("click", () => {
      missingView.classList.remove("active");
      inventoryView.style.display = "block";
      updateReassortBanner();
      renderLists();
      window.scrollTo({ top: 0, behavior: "smooth" });
    });

    notesFields.forEach((field) => {
      field.addEventListener("input", (event) => {
        state.notes = event.target.value;
        notesFields.forEach((otherField) => {
          if (otherField !== event.target) {
            otherField.value = state.notes;
          }
        });
        saveState();
      });
    });

    function resetListWithConfirm() {
      const confirmed = window.confirm("Êtes-vous sûr de réinitialiser la liste ?");
      if (!confirmed) {
        return;
      }
      items.forEach((item) => {
        state.counts[item.id] = 0;
        state.done[item.id] = false;
      });
      state.notes = "";
      saveState();
      renderLists();
      renderMissing();
    }

    document.getElementById("reset-button").addEventListener("click", resetListWithConfirm);
    document.getElementById("top-reset-button").addEventListener("click", resetListWithConfirm);

    renderLists();
    syncNotesFields();
  </script>
</body>
</html>
